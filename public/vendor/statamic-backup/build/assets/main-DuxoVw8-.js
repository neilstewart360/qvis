const U={methods:{actionStarted(){this.loading=!0},actionCompleted(s=null,e={}){this.loading=!1,s!==!1&&(this.$events.$emit("clear-selections"),this.$events.$emit("reset-action-modals"),e.success===!1?this.$toast.error(e.message||__("Action failed")):this.$toast.success(e.message||__("Action completed")),this.afterActionSuccessfullyCompleted())},afterActionSuccessfullyCompleted(){this.request()}}},L={data(){return{activeFilterBadges:{},activeFilters:{},activePreset:null,activePresetPayload:{},searchQuery:""}},computed:{activeFilterCount(){let s=Object.keys(this.activeFilters).length;return this.activeFilters.hasOwnProperty("fields")&&(s=s+Object.keys(this.activeFilters.fields).filter(e=>e!="badge").length-1),s},canSave(){return this.isDirty&&this.preferencesPrefix},isDirty(){return this.isFiltering?this.activePreset?this.activePresetPayload.query!=this.searchQuery||!_.isEqual(this.activePresetPayload.filters||{},this.activeFilters):!0:!1},isFiltering(){return!_.isEmpty(this.activeFilters)||this.searchQuery||this.activePreset},hasActiveFilters(){return this.activeFilterCount>0},searchPlaceholder(){return this.activePreset?`${__("Searching in:")} ${this.activePresetPayload.display}`:__("Search")}},methods:{searchChanged(s){this.searchQuery=s},hasFields(s){for(const e in s)if(s[e])return!0;return!1},filterChanged({handle:s,values:e},o=!0){e&&this.hasFields(e)?Vue.set(this.activeFilters,s,e):Vue.delete(this.activeFilters,s),o&&this.unselectAllItems()},filtersChanged(s){this.activeFilters={};for(const e in s){const o=s[e];this.filterChanged({handle:e,values:o},!1)}this.unselectAllItems()},filtersReset(){this.activePreset=null,this.activePresetPayload={},this.searchQuery="",this.activeFilters={},this.activeFilterBadges={}},unselectAllItems(){this.$refs.dataList&&this.$refs.dataList.clearSelections()},selectPreset(s,e){this.activePreset=s,this.activePresetPayload=e,this.searchQuery=e.query,this.filtersChanged(e.filters)},autoApplyFilters(s){if(!s)return;let e={};s.filter(o=>!_.isEmpty(o.auto_apply)).forEach(o=>{e[o.handle]=o.auto_apply}),this.activeFilters=e}}},M={props:{initialPerPage:{type:Number,default(){return Statamic.$config.get("paginationSize")}}},data(){return{perPage:this.initialPerPage,page:1}},mounted(){this.setInitialPerPage()},methods:{setInitialPerPage(){this.hasPreferences&&(this.perPage=this.getPreference("per_page")||this.initialPerPage)},changePerPage(s){s=parseInt(s),(this.hasPreferences?this.setPreference("per_page",s!=this.initialPerPage?s:null):Promise.resolve()).then(o=>{this.perPage=s,this.resetPage()})},selectPage(s){this.page=s,this.$events.$emit("clear-selections")},resetPage(){this.page=1,this.$events.$emit("clear-selections")}}},Q={data(){return{preferencesPrefix:null}},computed:{hasPreferences(){return this.preferencesPrefix!==null}},methods:{preferencesKey(s){return`${this.preferencesPrefix}.${s}`},getPreference(s){return this.$preferences.get(this.preferencesKey(s))},setPreference(s,e){return this.$preferences.set(this.preferencesKey(s),e)},removePreference(s,e=null){return this.$preferences.remove(this.preferencesKey(s),e)}}};function $(s,e,o,a,c,C,S,j){var x=typeof s=="function"?s.options:s;return e&&(x.render=e,x.staticRenderFns=o,x._compiled=!0),{exports:s,options:x}}const H={mixins:[U,L,M,Q],props:{initialSortColumn:String,initialSortDirection:String,initialColumns:{type:Array,default:()=>[]},filters:Array,actionUrl:String},data(){return{source:null,initializing:!0,loading:!0,items:[],columns:this.initialColumns,visibleColumns:this.initialColumns.filter(s=>s.visible),sortColumn:this.initialSortColumn,sortDirection:this.initialSortDirection,meta:null,pushQuery:!1,popping:!1}},computed:{parameterMap(){return{sort:"sortColumn",order:"sortDirection",page:"page",perPage:"perPage",search:"searchQuery",filters:"activeFilterParameters",columns:"visibleColumnParameters"}},parameters:{get(){return{...Object.fromEntries(Object.entries(this.parameterMap).map(([e,o])=>[e,this[o]]).filter(([e,o])=>o!=null&&o!=="")),...this.additionalParameters}},set(s){Object.entries(this.parameterMap).forEach(([e,o])=>{s.hasOwnProperty(e)&&(this[o]=s[e])})}},activeFilterParameters:{get(){return _.isEmpty(this.activeFilters)?null:utf8btoa(JSON.stringify(this.activeFilters))},set(s){this.activeFilters=JSON.parse(utf8atob(s))}},visibleColumnParameters:{get(){return _.isEmpty(this.visibleColumns)?null:this.visibleColumns.map(s=>s.field).join(",")},set(s){this.visibleColumns=s.split(",").map(e=>this.columns.find(o=>o.field===e))}},additionalParameters(){return{}},shouldRequestFirstPage(){return this.page>1&&this.items.length===0?(this.page=1,!0):!1}},created(){this.autoApplyFilters(this.filters),this.autoApplyState(),this.request()},mounted(){this.pushQuery&&(window.history.replaceState({parameters:this.parameters},""),window.addEventListener("popstate",this.popState))},beforeDestroy(){this.pushQuery&&window.removeEventListener("popstate",this.popState)},watch:{parameters:{deep:!0,handler(s,e){e.search===s.search&&JSON.stringify(e)!==JSON.stringify(s)&&(this.request(),this.pushState())}},loading:{immediate:!0,handler(s){this.$progress.loading(this.listingKey,s)}},searchQuery(s){this.sortColumn=null,this.sortDirection=null,this.resetPage(),this.request(),this.pushState()}},methods:{request(){if(!this.requestUrl){this.loading=!1;return}this.loading=!0,this.source&&this.source.cancel(),this.source=this.$axios.CancelToken.source(),this.$axios.get(this.requestUrl,{params:this.parameters,cancelToken:this.source.token}).then(s=>{if(this.columns=s.data.meta.columns,this.activeFilterBadges={...s.data.meta.activeFilterBadges},this.items=Object.values(s.data.data),this.meta=s.data.meta,this.shouldRequestFirstPage)return this.request();this.loading=!1,this.initializing=!1,this.afterRequestCompleted(s)}).catch(s=>{this.$axios.isCancel(s)||(this.loading=!1,this.initializing=!1,!(s.request&&!s.response)&&this.$toast.error(s.response?s.response.data.message:__("Something went wrong"),{duration:null}))})},afterRequestCompleted(s){},sorted(s,e){this.sortColumn=s,this.sortDirection=e},removeRow(s){let e=s.id,o=_.indexOf(this.rows,_.findWhere(this.rows,{id:e}));this.rows.splice(o,1),this.rows.length===0&&location.reload()},popState(s){!this.pushQuery||!s.state||(this.popping=!0,this.parameters=s.state.parameters,this.$nextTick(()=>{this.popping=!1}))},pushState(){if(!this.pushQuery||this.popping)return;const s=this.parameters,e=Object.keys(this.parameterMap),o=new URLSearchParams(Object.fromEntries(e.filter(a=>s.hasOwnProperty(a)).map(a=>[a,s[a]])));window.history.pushState({parameters:s},"","?"+o.toString())},autoApplyState(){if(!this.pushQuery||!window.location.search)return;const s=new URLSearchParams(window.location.search),e=Object.fromEntries(s.entries());this.popping=!0,this.parameters=e,this.$nextTick(()=>{this.popping=!1})}}},K=null,G=null;var J=$(H,K,G);const X=J.exports,V={mixins:[X],mounted(){this.$on("onDestroyed",this.request),this.$root.$on("uploaded",this.request)},watch:{status(s,e){s===e||e==="initializing"||!["backup_completed","restore_completed"].includes(s)||(this.request(),s==="backup_completed"?this.$toast.success(__("statamic-backup::backup.success")):s==="restore_completed"&&this.$toast.success(__("statamic-backup::backup.restore.success")))}},data(){return{requestUrl:cp_url("api/backups"),columns:this.initialColumns,confirmingRestore:!1,confirmingDestroy:!1,activeId:null,activeName:null}},computed:{status(){return this.$store.state["backup-provider"].status},canDownload(){return this.$store.getters["backup-provider/abilities"].download},canRestore(){return this.$store.getters["backup-provider/abilities"].restore},canDestroy(){return this.$store.getters["backup-provider/abilities"].destroy},showActions(){return this.canDownload.isPermitted||this.canRestore.isPermitted||this.canDestroy.isPermitted}},methods:{download_url(s){return cp_url("api/backups/download/"+s)},restore_url(s){return cp_url("api/backups/restore/"+s)},destroy_url(s){return cp_url("api/backups/"+s)},initiateDestroy(s,e){this.activeId=s,this.activeName=e,this.confirmingDestroy=!0},initiateRestore(s,e){this.activeId=s,this.activeName=e,this.confirmingRestore=!0},restore(){if(this.confirmingRestore=!1,!this.canRestore.isPossible)return console.warn("Cannot restore backups.");this.$store.dispatch("backup-provider/setStatus","restore_in_progress"),this.$axios.post(this.restore_url(this.activeId)).then(({data:s})=>{this.$toast.info(__(s.message)),this.$emit("onRestored")}).catch(s=>{let e=__("statamic-backup::backup.restore.failed");s.response.data.message&&(e=s.response.data.message),this.$toast.error(__(e))}).finally(()=>{this.activeName=null,this.activeId=null})},destroy(){if(!this.canDestroy.isPossible)return console.warn("Cannot destroy backups.");this.confirmingDestroy=!1,this.$axios.delete(this.destroy_url(this.activeId)).then(({data:s})=>{this.$toast.success(__(s.message)),this.$emit("onDestroyed")}).catch(s=>{let e="Something went wrong.";s.response.data.message&&(e=s.response.data.message),this.$toast.error(__(e))}).finally(()=>{this.activeName=null,this.activeId=null})}}};var W=function(){var e=this,o=e._self._c;return o("div",[e.initializing||e.status==="initializing"?o("div",{staticClass:"loading"},[o("loading-graphic")],1):e.items.length?o("data-list",{attrs:{"visible-columns":e.columns,columns:e.columns,rows:e.items},scopedSlots:e._u([{key:"default",fn:function({filteredRows:a}){return o("div",{staticClass:"card overflow-hidden p-0 relative"},[o("data-list-bulk-actions",{staticClass:"rounded",attrs:{url:e.actionUrl},on:{started:e.actionStarted,completed:e.actionCompleted}}),o("data-list-table",{scopedSlots:e._u([{key:"cell-name",fn:function({row:c,value:C}){return[o("div",{staticClass:"flex items-center"},[c.metadata.skipped_pipes.length?o("svg-icon",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:c.metadata.skipped_pipes.map(S=>`${S.pipe}: ${S.reason}`).join("<br/>"),html:!0},expression:"{ content: backup.metadata.skipped_pipes.map(x => `${x.pipe}: ${x.reason}`).join('<br/>'), html:true}"}],staticClass:"h-4 w-4 mr-2 text-orange",attrs:{name:"alert"}}):e._e(),e._v(" "+e._s(C)+" ")],1)]}},{key:"actions",fn:function({row:c}){return e.showActions?[o("dropdown-list",[e.canDownload.isPermitted?o("dropdown-item",{attrs:{disabled:!e.canDownload.isPossible,text:e.__("statamic-backup::backup.download.label"),redirect:e.download_url(c.id)}}):e._e(),e.canRestore.isPermitted&&e.canRestore.isPossible?o("span",[o("hr",{staticClass:"divider"}),o("dropdown-item",{attrs:{disabled:!e.canRestore.isPossible,text:e.__("statamic-backup::backup.restore.label")},on:{click:function(C){return e.initiateRestore(c.id,c.name)}}})],1):e._e(),e.canDestroy.isPermitted&&e.canDestroy.isPossible?o("span",[o("hr",{staticClass:"divider"}),o("dropdown-item",{attrs:{text:e.__("statamic-backup::backup.destroy.label"),dangerous:"true"},on:{click:function(C){return e.initiateDestroy(c.id,c.name)}}})],1):e._e()],1)]:void 0}}],null,!0)})],1)}}])}):o("div",[o("p",{staticClass:"text-center mt-16"},[e._v(e._s(e.__("statamic-backup::backup.no_backups")))])]),e.confirmingRestore?o("confirmation-modal",{attrs:{title:e.__("statamic-backup::backup.restore.confirm_title"),bodyText:e.__("statamic-backup::backup.restore.confirm_body",{name:e.activeName}),buttonText:e.__("statamic-backup::backup.restore.label")},on:{confirm:function(a){return e.restore()},cancel:function(a){e.confirmingRestore=!1}}}):e._e(),e.confirmingDestroy?o("confirmation-modal",{attrs:{title:e.__("statamic-backup::backup.destroy.confirm_title"),bodyText:e.__("statamic-backup::backup.destroy.confirm_body",{name:e.activeName}),buttonText:e.__("statamic-backup::backup.destroy.label")},on:{confirm:function(a){return e.destroy()},cancel:function(a){e.confirmingDestroy=!1}}}):e._e()],1)},Y=[],Z=$(V,W,Y);const ee=Z.exports;function te(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var N={exports:{}},I;function se(){return I||(I=1,function(s){(function(){var e=function(o){if(!(this instanceof e))return new e(o);if(this.version=1,this.support=typeof File<"u"&&typeof Blob<"u"&&typeof FileList<"u"&&(!!Blob.prototype.webkitSlice||!!Blob.prototype.mozSlice||!!Blob.prototype.slice||!1),!this.support)return!1;var a=this;a.files=[],a.defaults={chunkSize:1048576,forceChunkSize:!1,simultaneousUploads:3,fileParameterName:"file",chunkNumberParameterName:"resumableChunkNumber",chunkSizeParameterName:"resumableChunkSize",currentChunkSizeParameterName:"resumableCurrentChunkSize",totalSizeParameterName:"resumableTotalSize",typeParameterName:"resumableType",identifierParameterName:"resumableIdentifier",fileNameParameterName:"resumableFilename",relativePathParameterName:"resumableRelativePath",totalChunksParameterName:"resumableTotalChunks",throttleProgressCallbacks:.5,query:{},headers:{},preprocess:null,method:"multipart",uploadMethod:"POST",testMethod:"GET",prioritizeFirstAndLastChunk:!1,target:"/",testTarget:null,parameterNamespace:"",testChunks:!0,generateUniqueIdentifier:null,getTarget:null,maxChunkRetries:100,chunkRetryInterval:void 0,permanentErrors:[400,404,415,500,501],maxFiles:void 0,withCredentials:!1,xhrTimeout:0,clearInput:!0,chunkFormat:"blob",setChunkTypeFromFile:!1,maxFilesErrorCallback:function(r,n){var l=a.getOpt("maxFiles");alert("Please upload no more than "+l+" file"+(l===1?"":"s")+" at a time.")},minFileSize:1,minFileSizeErrorCallback:function(r,n){alert(r.fileName||r.name+" is too small, please upload files larger than "+c.formatSize(a.getOpt("minFileSize"))+".")},maxFileSize:void 0,maxFileSizeErrorCallback:function(r,n){alert(r.fileName||r.name+" is too large, please upload files less than "+c.formatSize(a.getOpt("maxFileSize"))+".")},fileType:[],fileTypeErrorCallback:function(r,n){alert(r.fileName||r.name+" has type not allowed, please upload files of type "+a.getOpt("fileType")+".")}},a.opts=o||{},a.getOpt=function(r){var n=this;if(r instanceof Array){var l={};return c.each(r,function(i){l[i]=n.getOpt(i)}),l}if(n instanceof D){if(typeof n.opts[r]<"u")return n.opts[r];n=n.fileObj}if(n instanceof E){if(typeof n.opts[r]<"u")return n.opts[r];n=n.resumableObj}if(n instanceof e)return typeof n.opts[r]<"u"?n.opts[r]:n.defaults[r]},a.events=[],a.on=function(r,n){a.events.push(r.toLowerCase(),n)},a.fire=function(){for(var r=[],n=0;n<arguments.length;n++)r.push(arguments[n]);for(var l=r[0].toLowerCase(),n=0;n<=a.events.length;n+=2)a.events[n]==l&&a.events[n+1].apply(a,r.slice(1)),a.events[n]=="catchall"&&a.events[n+1].apply(null,r);l=="fileerror"&&a.fire("error",r[2],r[1]),l=="fileprogress"&&a.fire("progress")};var c={stopEvent:function(r){r.stopPropagation(),r.preventDefault()},each:function(r,n){if(typeof r.length<"u"){for(var l=0;l<r.length;l++)if(n(r[l])===!1)return}else for(l in r)if(n(l,r[l])===!1)return},generateUniqueIdentifier:function(r,n){var l=a.getOpt("generateUniqueIdentifier");if(typeof l=="function")return l(r,n);var i=r.webkitRelativePath||r.fileName||r.name,t=r.size;return t+"-"+i.replace(/[^0-9a-zA-Z_-]/img,"")},contains:function(r,n){var l=!1;return c.each(r,function(i){return i==n?(l=!0,!1):!0}),l},formatSize:function(r){return r<1024?r+" bytes":r<1024*1024?(r/1024).toFixed(0)+" KB":r<1024*1024*1024?(r/1024/1024).toFixed(1)+" MB":(r/1024/1024/1024).toFixed(1)+" GB"},getTarget:function(r,n){var l=a.getOpt("target");if(r==="test"&&a.getOpt("testTarget")&&(l=a.getOpt("testTarget")==="/"?a.getOpt("target"):a.getOpt("testTarget")),typeof l=="function")return l(n);var i=l.indexOf("?")<0?"?":"&",t=n.join("&");return l+i+t}},C=function(r){c.stopEvent(r),r.dataTransfer&&r.dataTransfer.items?T(r.dataTransfer.items,r):r.dataTransfer&&r.dataTransfer.files&&T(r.dataTransfer.files,r)},S=function(r){r.preventDefault()};function j(r,n,l,i){var t;if(r.isFile)return r.file(function(d){d.relativePath=n+d.name,l.push(d),i()});if(r.isDirectory?t=r:r instanceof File&&l.push(r),typeof r.webkitGetAsEntry=="function"&&(t=r.webkitGetAsEntry()),t&&t.isDirectory)return A(t,n+t.name+"/",l,i);typeof r.getAsFile=="function"&&(r=r.getAsFile(),r instanceof File&&(r.relativePath=n+r.name,l.push(r))),i()}function x(r,n){if(!r||r.length===0)return n();r[0](function(){x(r.slice(1),n)})}function A(r,n,l,i){var t=r.createReader();t.readEntries(function(d){if(!d.length)return i();x(d.map(function(u){return j.bind(null,u,n,l)}),i)})}function T(r,n){if(r.length){a.fire("beforeAdd");var l=[];x(Array.prototype.map.call(r,function(i){return j.bind(null,i,"",l)}),function(){l.length&&F(l,n)})}}var F=function(r,n){var l=0,i=a.getOpt(["maxFiles","minFileSize","maxFileSize","maxFilesErrorCallback","minFileSizeErrorCallback","maxFileSizeErrorCallback","fileType","fileTypeErrorCallback"]);if(typeof i.maxFiles<"u"&&i.maxFiles<r.length+a.files.length)if(i.maxFiles===1&&a.files.length===1&&r.length===1)a.removeFile(a.files[0]);else return i.maxFilesErrorCallback(r,l++),!1;var t=[],d=[],u=r.length,f=function(){if(!--u){if(!t.length&&!d.length)return;window.setTimeout(function(){a.fire("filesAdded",t,d)},0)}};c.each(r,function(p){var g=p.name;if(i.fileType.length>0){var k=!1;for(var b in i.fileType){var h="."+i.fileType[b];if(g.toLowerCase().indexOf(h.toLowerCase(),g.length-h.length)!==-1){k=!0;break}}if(!k)return i.fileTypeErrorCallback(p,l++),!1}if(typeof i.minFileSize<"u"&&p.size<i.minFileSize)return i.minFileSizeErrorCallback(p,l++),!1;if(typeof i.maxFileSize<"u"&&p.size>i.maxFileSize)return i.maxFileSizeErrorCallback(p,l++),!1;function O(P){a.getFromUniqueIdentifier(P)?d.push(p):function(){p.uniqueIdentifier=P;var w=new E(a,p,P);a.files.push(w),t.push(w),w.container=typeof n<"u"?n.srcElement:null,window.setTimeout(function(){a.fire("fileAdded",w,n)},0)}(),f()}var y=c.generateUniqueIdentifier(p,n);y&&typeof y.then=="function"?y.then(function(P){O(P)},function(){f()}):O(y)})};function E(r,n,l){var i=this;i.opts={},i.getOpt=r.getOpt,i._prevProgress=0,i.resumableObj=r,i.file=n,i.fileName=n.fileName||n.name,i.size=n.size,i.relativePath=n.relativePath||n.webkitRelativePath||i.fileName,i.uniqueIdentifier=l,i._pause=!1,i.container="";var t=l!==void 0,d=function(u,f){switch(u){case"progress":i.resumableObj.fire("fileProgress",i,f);break;case"error":i.abort(),t=!0,i.chunks=[],i.resumableObj.fire("fileError",i,f);break;case"success":if(t)return;i.resumableObj.fire("fileProgress",i),i.isComplete()&&i.resumableObj.fire("fileSuccess",i,f);break;case"retry":i.resumableObj.fire("fileRetry",i);break}};return i.chunks=[],i.abort=function(){var u=0;c.each(i.chunks,function(f){f.status()=="uploading"&&(f.abort(),u++)}),u>0&&i.resumableObj.fire("fileProgress",i)},i.cancel=function(){var u=i.chunks;i.chunks=[],c.each(u,function(f){f.status()=="uploading"&&(f.abort(),i.resumableObj.uploadNextChunk())}),i.resumableObj.removeFile(i),i.resumableObj.fire("fileProgress",i)},i.retry=function(){i.bootstrap();var u=!1;i.resumableObj.on("chunkingComplete",function(){u||i.resumableObj.upload(),u=!0})},i.bootstrap=function(){i.abort(),t=!1,i.chunks=[],i._prevProgress=0;for(var u=i.getOpt("forceChunkSize")?Math.ceil:Math.floor,f=Math.max(u(i.file.size/i.getOpt("chunkSize")),1),p=0;p<f;p++)(function(g){window.setTimeout(function(){i.chunks.push(new D(i.resumableObj,i,g,d)),i.resumableObj.fire("chunkingProgress",i,g/f)},0)})(p);window.setTimeout(function(){i.resumableObj.fire("chunkingComplete",i)},0)},i.progress=function(){if(t)return 1;var u=0,f=!1;return c.each(i.chunks,function(p){p.status()=="error"&&(f=!0),u+=p.progress(!0)}),u=f||u>.99999?1:u,u=Math.max(i._prevProgress,u),i._prevProgress=u,u},i.isUploading=function(){var u=!1;return c.each(i.chunks,function(f){if(f.status()=="uploading")return u=!0,!1}),u},i.isComplete=function(){var u=!1;return c.each(i.chunks,function(f){var p=f.status();if(p=="pending"||p=="uploading"||f.preprocessState===1)return u=!0,!1}),!u},i.pause=function(u){typeof u>"u"?i._pause=!i._pause:i._pause=u},i.isPaused=function(){return i._pause},i.resumableObj.fire("chunkingStart",i),i.bootstrap(),this}function D(r,n,l,i){var t=this;t.opts={},t.getOpt=r.getOpt,t.resumableObj=r,t.fileObj=n,t.fileObjSize=n.size,t.fileObjType=n.file.type,t.offset=l,t.callback=i,t.lastProgressCallback=new Date,t.tested=!1,t.retries=0,t.pendingRetry=!1,t.preprocessState=0;var d=t.getOpt("chunkSize");return t.loaded=0,t.startByte=t.offset*d,t.endByte=Math.min(t.fileObjSize,(t.offset+1)*d),t.fileObjSize-t.endByte<d&&!t.getOpt("forceChunkSize")&&(t.endByte=t.fileObjSize),t.xhr=null,t.test=function(){t.xhr=new XMLHttpRequest;var u=function(b){t.tested=!0;var h=t.status();h=="success"?(t.callback(h,t.message()),t.resumableObj.uploadNextChunk()):t.send()};t.xhr.addEventListener("load",u,!1),t.xhr.addEventListener("error",u,!1),t.xhr.addEventListener("timeout",u,!1);var f=[],p=t.getOpt("parameterNamespace"),g=t.getOpt("query");typeof g=="function"&&(g=g(t.fileObj,t)),c.each(g,function(b,h){f.push([encodeURIComponent(p+b),encodeURIComponent(h)].join("="))}),f=f.concat([["chunkNumberParameterName",t.offset+1],["chunkSizeParameterName",t.getOpt("chunkSize")],["currentChunkSizeParameterName",t.endByte-t.startByte],["totalSizeParameterName",t.fileObjSize],["typeParameterName",t.fileObjType],["identifierParameterName",t.fileObj.uniqueIdentifier],["fileNameParameterName",t.fileObj.fileName],["relativePathParameterName",t.fileObj.relativePath],["totalChunksParameterName",t.fileObj.chunks.length]].filter(function(b){return t.getOpt(b[0])}).map(function(b){return[p+t.getOpt(b[0]),encodeURIComponent(b[1])].join("=")})),t.xhr.open(t.getOpt("testMethod"),c.getTarget("test",f)),t.xhr.timeout=t.getOpt("xhrTimeout"),t.xhr.withCredentials=t.getOpt("withCredentials");var k=t.getOpt("headers");typeof k=="function"&&(k=k(t.fileObj,t)),c.each(k,function(b,h){t.xhr.setRequestHeader(b,h)}),t.xhr.send(null)},t.preprocessFinished=function(){t.preprocessState=2,t.send()},t.send=function(){var u=t.getOpt("preprocess");if(typeof u=="function")switch(t.preprocessState){case 0:t.preprocessState=1,u(t);return;case 1:return}if(t.getOpt("testChunks")&&!t.tested){t.test();return}t.xhr=new XMLHttpRequest,t.xhr.upload.addEventListener("progress",function(m){new Date-t.lastProgressCallback>t.getOpt("throttleProgressCallbacks")*1e3&&(t.callback("progress"),t.lastProgressCallback=new Date),t.loaded=m.loaded||0},!1),t.loaded=0,t.pendingRetry=!1,t.callback("progress");var f=function(m){var v=t.status();if(v=="success"||v=="error")t.callback(v,t.message()),t.resumableObj.uploadNextChunk();else{t.callback("retry",t.message()),t.abort(),t.retries++;var q=t.getOpt("chunkRetryInterval");q!==void 0?(t.pendingRetry=!0,setTimeout(t.send,q)):t.send()}};t.xhr.addEventListener("load",f,!1),t.xhr.addEventListener("error",f,!1),t.xhr.addEventListener("timeout",f,!1);var p=[["chunkNumberParameterName",t.offset+1],["chunkSizeParameterName",t.getOpt("chunkSize")],["currentChunkSizeParameterName",t.endByte-t.startByte],["totalSizeParameterName",t.fileObjSize],["typeParameterName",t.fileObjType],["identifierParameterName",t.fileObj.uniqueIdentifier],["fileNameParameterName",t.fileObj.fileName],["relativePathParameterName",t.fileObj.relativePath],["totalChunksParameterName",t.fileObj.chunks.length]].filter(function(m){return t.getOpt(m[0])}).reduce(function(m,v){return m[t.getOpt(v[0])]=v[1],m},{}),g=t.getOpt("query");typeof g=="function"&&(g=g(t.fileObj,t)),c.each(g,function(m,v){p[m]=v});var k=t.fileObj.file.slice?"slice":t.fileObj.file.mozSlice?"mozSlice":t.fileObj.file.webkitSlice?"webkitSlice":"slice",b=t.fileObj.file[k](t.startByte,t.endByte,t.getOpt("setChunkTypeFromFile")?t.fileObj.file.type:""),h=null,O=[],y=t.getOpt("parameterNamespace");if(t.getOpt("method")==="octet")h=b,c.each(p,function(m,v){O.push([encodeURIComponent(y+m),encodeURIComponent(v)].join("="))});else if(h=new FormData,c.each(p,function(m,v){h.append(y+m,v),O.push([encodeURIComponent(y+m),encodeURIComponent(v)].join("="))}),t.getOpt("chunkFormat")=="blob")h.append(y+t.getOpt("fileParameterName"),b,t.fileObj.fileName);else if(t.getOpt("chunkFormat")=="base64"){var P=new FileReader;P.onload=function(m){h.append(y+t.getOpt("fileParameterName"),P.result),t.xhr.send(h)},P.readAsDataURL(b)}var w=c.getTarget("upload",O),B=t.getOpt("uploadMethod");t.xhr.open(B,w),t.getOpt("method")==="octet"&&t.xhr.setRequestHeader("Content-Type","application/octet-stream"),t.xhr.timeout=t.getOpt("xhrTimeout"),t.xhr.withCredentials=t.getOpt("withCredentials");var R=t.getOpt("headers");typeof R=="function"&&(R=R(t.fileObj,t)),c.each(R,function(m,v){t.xhr.setRequestHeader(m,v)}),t.getOpt("chunkFormat")=="blob"&&t.xhr.send(h)},t.abort=function(){t.xhr&&t.xhr.abort(),t.xhr=null},t.status=function(){return t.pendingRetry?"uploading":t.xhr?t.xhr.readyState<4?"uploading":t.xhr.status==200||t.xhr.status==201?"success":c.contains(t.getOpt("permanentErrors"),t.xhr.status)||t.retries>=t.getOpt("maxChunkRetries")?"error":(t.abort(),"pending"):"pending"},t.message=function(){return t.xhr?t.xhr.responseText:""},t.progress=function(u){typeof u>"u"&&(u=!1);var f=u?(t.endByte-t.startByte)/t.fileObjSize:1;if(t.pendingRetry)return 0;(!t.xhr||!t.xhr.status)&&(f*=.95);var p=t.status();switch(p){case"success":case"error":return 1*f;case"pending":return 0*f;default:return t.loaded/(t.endByte-t.startByte)*f}},this}return a.uploadNextChunk=function(){var r=!1;if(a.getOpt("prioritizeFirstAndLastChunk")&&(c.each(a.files,function(l){if(l.chunks.length&&l.chunks[0].status()=="pending"&&l.chunks[0].preprocessState===0)return l.chunks[0].send(),r=!0,!1;if(l.chunks.length>1&&l.chunks[l.chunks.length-1].status()=="pending"&&l.chunks[l.chunks.length-1].preprocessState===0)return l.chunks[l.chunks.length-1].send(),r=!0,!1}),r)||(c.each(a.files,function(l){if(l.isPaused()===!1&&c.each(l.chunks,function(i){if(i.status()=="pending"&&i.preprocessState===0)return i.send(),r=!0,!1}),r)return!1}),r))return!0;var n=!1;return c.each(a.files,function(l){if(!l.isComplete())return n=!0,!1}),n||a.fire("complete"),!1},a.assignBrowse=function(r,n){typeof r.length>"u"&&(r=[r]),c.each(r,function(l){var i;l.tagName==="INPUT"&&l.type==="file"?i=l:(i=document.createElement("input"),i.setAttribute("type","file"),i.style.display="none",l.addEventListener("click",function(){i.style.opacity=0,i.style.display="block",i.focus(),i.click(),i.style.display="none"},!1),l.appendChild(i));var t=a.getOpt("maxFiles");typeof t>"u"||t!=1?i.setAttribute("multiple","multiple"):i.removeAttribute("multiple"),n?i.setAttribute("webkitdirectory","webkitdirectory"):i.removeAttribute("webkitdirectory");var d=a.getOpt("fileType");typeof d<"u"&&d.length>=1?i.setAttribute("accept",d.map(function(u){return"."+u}).join(",")):i.removeAttribute("accept"),i.addEventListener("change",function(u){F(u.target.files,u);var f=a.getOpt("clearInput");f&&(u.target.value="")},!1)})},a.assignDrop=function(r){typeof r.length>"u"&&(r=[r]),c.each(r,function(n){n.addEventListener("dragover",S,!1),n.addEventListener("dragenter",S,!1),n.addEventListener("drop",C,!1)})},a.unAssignDrop=function(r){typeof r.length>"u"&&(r=[r]),c.each(r,function(n){n.removeEventListener("dragover",S),n.removeEventListener("dragenter",S),n.removeEventListener("drop",C)})},a.isUploading=function(){var r=!1;return c.each(a.files,function(n){if(n.isUploading())return r=!0,!1}),r},a.upload=function(){if(!a.isUploading()){a.fire("uploadStart");for(var r=1;r<=a.getOpt("simultaneousUploads");r++)a.uploadNextChunk()}},a.pause=function(){c.each(a.files,function(r){r.abort()}),a.fire("pause")},a.cancel=function(){a.fire("beforeCancel");for(var r=a.files.length-1;r>=0;r--)a.files[r].cancel();a.fire("cancel")},a.progress=function(){var r=0,n=0;return c.each(a.files,function(l){r+=l.progress()*l.size,n+=l.size}),n>0?r/n:0},a.addFile=function(r,n){F([r],n)},a.addFiles=function(r,n){F(r,n)},a.removeFile=function(r){for(var n=a.files.length-1;n>=0;n--)a.files[n]===r&&a.files.splice(n,1)},a.getFromUniqueIdentifier=function(r){var n=!1;return c.each(a.files,function(l){l.uniqueIdentifier==r&&(n=l)}),n},a.getSize=function(){var r=0;return c.each(a.files,function(n){r+=n.size}),r},a.handleDropEvent=function(r){C(r)},a.handleChangeEvent=function(r){F(r.target.files,r),r.target.value=""},a.updateQuery=function(r){a.opts.query=r},this};s.exports=e})()}(N)),N.exports}var re=se();const ie=te(re),ae={props:{files:{type:Array,default:()=>[]}},data(){return{resumable:null,confirming:!1,loading:!1}},computed:{canCreateBackups(){return this.$store.getters["backup-provider/abilities"].backup},canUpload(){return this.$store.getters["backup-provider/abilities"].restore}},methods:{findFile(s){return this.files.find(e=>e.file.uniqueIdentifier===s.uniqueIdentifier&&e.status!=="canceled")??{}}},mounted(){if(this.resumable=new ie({target:cp_url("backups/chunky"),testTarget:cp_url("backups/chunky/test"),headers:{Accept:"application/json","X-CSRF-TOKEN":document.querySelector("input[name=_token]").value},fileType:["zip"],testChunks:!0,chunkSize:window.backup.chunkSize||2*1024*1024,forceChunkSize:!0,maxChunkRetries:1,maxFiles:1}),!this.resumable.support)return alert("Your browser doesn't support chunked uploads. Get a better browser.");this.$watch(s=>s.canCreateBackups.isPermitted&&s.canUpload.isPermitted&&s.canUpload.isPossible,s=>{s&&this.$refs.dropzone&&(this.resumable.assignBrowse(this.$refs.dropzone),this.resumable.assignDrop(this.$refs.dropzone))}),this.resumable.on("fileAdded",(s,e)=>{s.hasUploaded=!1,this.files.push({file:s,status:"uploading",progress:0,path:null}),this.resumable.upload()}),this.resumable.on("fileSuccess",(s,e)=>{const o=JSON.parse(e);this.$toast.success(o.message),this.$root.$emit("uploaded",s)}),this.resumable.on("fileError",(s,e)=>{this.findFile(s).status="error",this.$toast.error(JSON.parse(e).message)}),this.resumable.on("fileRetry",(s,e)=>{this.findFile(s).status="retrying"}),this.resumable.on("fileProgress",s=>{const e=this.findFile(s),o=s.progress();o>e.progress&&(e.progress=o)})}};var ne=function(){var e=this,o=e._self._c;return e.canCreateBackups.isPermitted&&e.canUpload.isPermitted&&e.canUpload.isPossible?o("div",{ref:"dropzone",staticClass:"btn mr-3"},[o("svg-icon",{staticClass:"h-4 w-4 mr-2 text-current",attrs:{name:"upload"}}),o("span",[e._v(e._s(e.__("statamic-backup::backup.upload.label")))])],1):e._e()},oe=[],le=$(ae,ne,oe);const ue=le.exports,ce={props:["basename","percent","status","file"],methods:{clear(){this.$emit("clear")},cancel(){this.file.file.cancel(),this.file.status="canceled",this.$emit("cancel",this.file)},pause(){this.$emit("pause",this.file)}}};var fe=function(){var e=this,o=e._self._c;return o("div",{staticClass:"flex items-center my-4 w-full justify-end",class:{"text-red-500":e.status=="error"}},[o("div",{staticClass:"mx-2 flex items-center"},[e.status==="canceled"?o("svg-icon",{staticClass:"h-4 w-4",attrs:{name:"micro/sharp-trash"}}):e.status==="error"?o("svg-icon",{staticClass:"text-red-500 h-4 w-4",attrs:{name:"micro/warning"}}):e.status==="uploading"?o("loading-graphic",{attrs:{inline:!0,text:""}}):e._e()],1),o("div",{staticClass:"filename",class:e.status==="restored"?"text-green-500":""},[e._v(" "+e._s(e.basename)+" ")]),e.status==="uploading"?o("div",{staticClass:"bg-white flex-1 h-4 mx-2 rounded"},[o("div",{staticClass:"bg-blue h-full rounded",style:{width:e.percent+"%"}})]):e._e(),o("div",{staticClass:"px-2"},[e.status==="canceled"?o("p",[e._v(e._s(e.__("statamic-backup::backup.upload.cancelled")))]):e._e(),e.status==="error"?o("div",[e._v(" "+e._s(e.error)+" "),o("button",{staticClass:"flex items-center text-gray-700 hover:text-gray-800",on:{click:function(a){return a.preventDefault(),e.clear.apply(null,arguments)}}},[o("svg-icon",{staticClass:"h-4 w-4",attrs:{name:"micro/circle-with-cross"}})],1)]):e._e(),e.status==="uploading"?o("button",{staticClass:"flex items-center text-gray-700 hover:text-gray-800",on:{click:function(a){return a.preventDefault(),e.cancel.apply(null,arguments)}}},[o("svg-icon",{staticClass:"h-4 w-4",attrs:{name:"micro/circle-with-cross"}})],1):e._e()])])},pe=[],de=$(ce,fe,pe);const he=de.exports,me={components:{upload:ue,"upload-status":he},mounted(){this.$root.$on("uploaded",s=>{this.files=this.files.filter(e=>e.file.uniqueIdentifier!==s.uniqueIdentifier)})},data(){return{files:[],confirming:!1,loading:!1}},computed:{status(){return this.$store.state["backup-provider"].status},canCreateBackups(){return this.$store.getters["backup-provider/abilities"].backup},canUpload(){return this.$store.getters["backup-provider/abilities"].restore}},methods:{backup(){this.loading=!0,this.confirming=!1,this.$store.dispatch("backup-provider/setStatus","backup_in_progress"),this.$axios.post(cp_url("api/backups"),{comment:this.value}).then(({data:s})=>{this.$toast.info(__(s.message))}).catch(s=>{let e="Something went wrong.";s.response.data.message&&(e=s.response.data.message),this.$toast.error(__(e))}).finally(()=>{this.loading=!1})}}};var ge=function(){var e=this,o=e._self._c;return o("div",{staticClass:"flex flex-col items-end w-full"},[o("div",{staticClass:"flex justify-end"},[o("upload",{attrs:{files:e.files}}),e.canCreateBackups.isPermitted?o("button",{staticClass:"btn-primary",class:{"btn-disabled":e.loading},attrs:{disabled:e.loading||!e.canCreateBackups.isPossible},on:{click:function(a){return e.backup()}}},[o("svg-icon",{staticClass:"h-4 w-4 mr-2 text-current",attrs:{name:"upload-cloud"}}),o("span",[e._v(e._s(e.__("statamic-backup::backup.create")))])],1):e._e()],1),o("ul",{staticClass:"mt-3 mb-3 w-full"},e._l(e.files,function(a,c){return o("upload-status",{key:a.file.uniqueIdentifier+c,attrs:{basename:a.file.fileName,status:a.status,percent:a.progress*100,file:a}})}),1)])},be=[],ve=$(me,ge,be);const ye=ve.exports,z=["initializing","queued","backup_in_progress","restore_in_progress"],_e=s=>z.includes(s)?2e3:5e3,ke={namespaced:!0,state:()=>({status:"initializing",timeout:null}),getters:{abilities:function(s){return{backup:{isPossible:!z.includes(s.status),isPermitted:Statamic.$store.state.statamic.config.user.super??Statamic.$store.state.statamic.config.user.permissions.includes("download backups")},download:{isPossible:!z.includes(s.status),isPermitted:Statamic.$store.state.statamic.config.user.super??Statamic.$store.state.statamic.config.user.permissions.includes("restore backups")},restore:{isPossible:!z.includes(s.status),isPermitted:Statamic.$store.state.statamic.config.user.super??Statamic.$store.state.statamic.config.user.permissions.includes("restore backups")},destroy:{isPossible:!z.includes(s.status),isPermitted:Statamic.$store.state.statamic.config.user.super??Statamic.$store.state.statamic.config.user.permissions.includes("delete backups")}}}},mutations:{setStatus(s,e){s.status=e},cancelPoll(s){clearTimeout(s.timeout),s.commit("timeout",null)}},actions:{setStatus:({commit:s},e)=>{s("setStatus",e)},stopPolling:({commit:s})=>{s("cancelPoll")},pollEndpoint:({commit:s})=>{const e=async()=>{let o;try{const a=await Statamic.$axios.get(cp_url("api/backups/state"));o=a.data.state,s("setStatus",a.data.state)}catch(a){console.error("Error fetching server state:",a)}finally{const a=_e(o);s("timeout",setTimeout(e,a))}};e()}}},Pe={components:{"backup-listing":ee,"backup-actions":ye},props:{chunkSize:{type:Number,default:2*1024*1024}},created(){window.backup={chunkSize:this.chunkSize},this.$store.hasModule("backup-provider")||(this.$store.registerModule("backup-provider",ke),this.$store.dispatch("backup-provider/pollEndpoint"))},computed:{status(){return this.$store.state["backup-provider"].status}},destroy(){this.$store.dispatch("backup-provider/stopPolling"),this.$store.unregisterModule("backup-provider")}};var Ce=function(){var e=this,o=e._self._c;return o("div",[o("div",{staticClass:"flex"},[o("div",{staticClass:"flex flex-col mb-4"},[o("h1",[e._v(e._s(e.__("statamic-backup::backup.title")))]),e.status!=="idle"?o("p",{staticClass:"text-sm text-gray-700 whitespace-nowrap"},[e._v(" "+e._s(e.__(`statamic-backup::backup.state.${e.status}`))+" ")]):e._e()]),o("backup-actions",{on:{openBrowser:e.openBrowser}})],1),o("backup-listing")],1)},Se=[],xe=$(Pe,Ce,Se);const Oe=xe.exports;Statamic.booting(()=>{Statamic.$components.register("itiden-backup",Oe)});
